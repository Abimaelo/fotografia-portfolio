<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - CMS</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Netlify Identity Widget - OAuth 2.0 -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <!-- OAuth Verification Script -->
    <script src="oauth-verification.js"></script>
    <style>
        /* Variables CSS para el admin - compatibles con el dise√±o monocrom√°tico */
        :root {
            /* Monochromatic Color Palette */
            --color-white: #ffffff;
            --color-off-white: #fafafa;
            --color-light-gray: #f5f5f5;
            --color-medium-gray: #999999;
            --color-dark-gray: #666666;
            --color-black: #1a1a1a;
            --color-true-black: #000000;
            
            /* Admin specific colors (for compatibility) */
            --primary-color: var(--color-black);
            --primary-hover: var(--color-dark-gray);
            --secondary-color: var(--color-medium-gray);
            --text-color: var(--color-black);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --success-color: #28a745;
            --error-color: #dc3545;
            --info-color: #17a2b8;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            font-family: 'Inter', sans-serif;
            background: var(--color-off-white);
            min-height: 100vh;
        }
        
        .admin-header {
            background: var(--color-black);
            color: var(--color-white);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }
        
        .admin-header h1 {
            font-family: 'Playfair Display', serif;
            font-weight: 400;
            margin: 0;
            font-size: 1.8rem;
            letter-spacing: -0.01em;
        }
        
        /* Solo UN bot√≥n de login - sin duplicaci√≥n */
        .auth-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
            flex-direction: column;
        }
        
        .login-card {
            background: var(--color-white);
            padding: 3rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        .login-card h2 {
            font-family: 'Playfair Display', serif;
            color: var(--color-black);
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }
        
        .login-card p {
            color: var(--color-dark-gray);
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        
        .login-btn {
            background: var(--color-black);
            color: var(--color-white);
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 1rem;
        }
        
        .login-btn:hover {
            background: var(--color-dark-gray);
        }
        
        .security-info {
            background: var(--color-light-gray);
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: var(--color-dark-gray);
        }
        
        .admin-panel {
            display: none;
        }
        
        .admin-nav {
            background: var(--color-white);
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--color-light-gray);
        }
        
        .admin-nav ul {
            display: flex;
            list-style: none;
            gap: 1rem;
            margin: 0;
            padding: 0;
            flex-wrap: wrap;
        }
        
        .admin-nav button {
            background: none;
            border: none;
            color: var(--color-dark-gray);
            font-family: 'DM Sans', sans-serif;
            font-weight: 400;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 2px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .admin-nav button:hover,
        .admin-nav button.active {
            color: var(--color-black);
            background: var(--color-light-gray);
        }
        
        .admin-content {
            background: var(--color-white);
            padding: 2rem;
            border-radius: 4px;
            box-shadow: var(--shadow);
            border: 1px solid var(--color-light-gray);
        }
        
        .admin-section {
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            color: var(--color-black);
            margin-bottom: 0.5rem;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-light-gray);
            border-radius: 4px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--color-black);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .save-btn {
            background: var(--color-black);
            color: var(--color-white);
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 2rem;
        }
        
        .save-btn:hover {
            background: var(--color-dark-gray);
        }
        
        .upload-btn {
            background: var(--color-medium-gray);
            color: var(--color-white);
            border: none;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-btn:hover {
            background: var(--color-dark-gray);
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        
        .list-item {
            background: var(--color-light-gray);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            border: 1px solid var(--color-medium-gray);
        }
        
        .list-item h4 {
            margin: 0 0 0.5rem 0;
            color: var(--color-black);
        }
        
        .remove-btn {
            background: var(--error-color);
            color: var(--color-white);
            border: none;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        
        .add-btn {
            background: var(--success-color);
            color: var(--color-white);
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 1rem 0;
        }
        
        .logout-btn {
            background: var(--error-color);
            color: var(--color-white);
            border: none;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-email {
            color: var(--color-white);
            font-size: 0.9rem;
        }
        
        .success-message,
        .error-message {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: 1rem;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .admin-nav ul {
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Wrapper - Solo UN sistema de autenticaci√≥n -->
    <div id="auth-wrapper" class="auth-wrapper">
        <div class="login-card">
            <h2>Acceso Seguro</h2>
            <p>Autent√≠cate con GitHub para acceder al panel de administraci√≥n</p>
            
            <!-- √önico bot√≥n de login -->
            <button class="login-btn" id="login-btn">
                üîê Iniciar Sesi√≥n con GitHub
            </button>
            
            <div class="security-info">
                <strong>Seguridad OAuth 2.0</strong><br>
                ‚úÖ Autenticaci√≥n segura con GitHub<br>
                ‚úÖ Sin almacenamiento de contrase√±as<br>
                ‚úÖ Tokens JWT de tiempo limitado<br>
                ‚úÖ Auditor√≠a completa de actividades
            </div>
        </div>
    </div>

    <!-- Admin Panel (Hidden until login) -->
    <div id="admin-panel" class="admin-panel">
        <div class="admin-container">
            <div class="admin-header">
                <h1>Panel de Administraci√≥n</h1>
                <div class="user-info">
                    <span class="user-email" id="user-email"></span>
                    <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
                </div>
            </div>
            
            <nav class="admin-nav">
                <ul>
                    <li><button onclick="showSection('general')" class="active">Configuraci√≥n General</button></li>
                    <li><button onclick="showSection('photographer')">Sobre el Fot√≥grafo</button></li>
                    <li><button onclick="showSection('hero')">Hero Section</button></li>
                    <li><button onclick="showSection('social')">Redes Sociales</button></li>
                    <li><button onclick="showSection('services')">Servicios</button></li>
                    <li><button onclick="showSection('portfolio')">Portfolio</button></li>
                    <li><button onclick="showSection('blog')">Blog</button></li>
                    <li><button onclick="showSection('contact')">Contacto</button></li>
                    <li><button onclick="showSection('preview')">Vista Previa</button></li>
                </ul>
            </nav>
            
            <div class="admin-content">
                <!-- Configuraci√≥n General -->
                <section id="general" class="admin-section active">
                    <h2>Configuraci√≥n General</h2>
                    <div class="form-group">
                        <label>T√≠tulo del Sitio</label>
                        <input type="text" id="site-title" placeholder="Nombre de tu sitio web">
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n</label>
                        <textarea id="site-description" rows="4" placeholder="Descripci√≥n breve de tu sitio"></textarea>
                    </div>
                </section>

                <!-- Sobre el Fot√≥grafo -->
                <section id="photographer" class="admin-section">
                    <h2>Sobre el Fot√≥grafo</h2>
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" id="photographer-name" placeholder="Tu nombre completo">
                    </div>
                    <div class="form-group">
                        <label>Biograf√≠a</label>
                        <textarea id="photographer-bio" rows="6" placeholder="Cu√©ntanos tu historia como fot√≥grafo"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Foto de Perfil</label>
                        <input type="file" id="photographer-photo" accept="image/*" onchange="uploadImage('photographer-photo')">
                        <img id="photographer-photo-preview" class="image-preview" style="display: none;">
                    </div>
                    <div class="form-group">
                        <label>Experiencia (a√±os)</label>
                        <input type="number" id="photographer-experience" min="0" placeholder="N√∫mero de a√±os de experiencia">
                    </div>
                </section>

                <!-- Hero Section -->
                <section id="hero" class="admin-section">
                    <h2>Hero Section</h2>
                    <div class="form-group">
                        <label>T√≠tulo Principal</label>
                        <input type="text" id="hero-title" placeholder="T√≠tulo impactante">
                    </div>
                    <div class="form-group">
                        <label>Subt√≠tulo</label>
                        <input type="text" id="hero-subtitle" placeholder="Descripci√≥n que complemente el t√≠tulo">
                    </div>
                    <div class="form-group">
                        <label>Imagen Hero</label>
                        <input type="file" id="hero-image" accept="image/*" onchange="uploadImage('hero-image')">
                        <img id="hero-image-preview" class="image-preview" style="display: none;">
                    </div>
                    <div class="form-group">
                        <label>Texto del Bot√≥n</label>
                        <input type="text" id="hero-button-text" placeholder="Ver Galer√≠a">
                    </div>
                </section>

                <!-- Servicios -->
                <section id="services" class="admin-section">
                    <h2>Servicios</h2>
                    <button class="add-btn" onclick="addService()">+ Agregar Servicio</button>
                    <div id="services-list">
                        <!-- Los servicios se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </section>

                <!-- Portfolio -->
                <section id="portfolio" class="admin-section">
                    <h2>Portfolio</h2>
                    <button class="add-btn" onclick="addPortfolioItem()">+ Agregar Proyecto</button>
                    <div id="portfolio-list">
                        <!-- Los proyectos se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </section>

                <!-- Blog -->
                <section id="blog" class="admin-section">
                    <h2>Blog</h2>
                    <button class="add-btn" onclick="addBlogPost()">+ Agregar Post</button>
                    <div id="blog-list">
                        <!-- Los posts se cargar√°n aqu√≠ din√°micamente -->
                    </div>
                </section>

                <!-- Redes Sociales -->
                <section id="social" class="admin-section">
                    <h2>Redes Sociales</h2>
                    <div class="form-group">
                        <label>Instagram</label>
                        <input type="url" id="social-instagram" placeholder="URL de tu Instagram">
                    </div>
                    <div class="form-group">
                        <label>Facebook</label>
                        <input type="url" id="social-facebook" placeholder="URL de tu Facebook">
                    </div>
                    <div class="form-group">
                        <label>Twitter</label>
                        <input type="url" id="social-twitter" placeholder="URL de tu Twitter">
                    </div>
                </section>

                <!-- Contacto -->
                <section id="contact" class="admin-section">
                    <h2>Informaci√≥n de Contacto</h2>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="contact-email" placeholder="tu@email.com">
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="tel" id="contact-phone" placeholder="+1 234 567 8900">
                    </div>
                    <div class="form-group">
                        <label>Direcci√≥n</label>
                        <textarea id="contact-address" rows="3" placeholder="Tu direcci√≥n"></textarea>
                    </div>
                </section>

                <!-- Vista Previa -->
                <section id="preview" class="admin-section">
                    <h2>Vista Previa</h2>
                    <p>Haz clic en el bot√≥n para ver c√≥mo se ve tu sitio web:</p>
                    <button class="add-btn" onclick="window.open('/', '_blank')">üîó Ver Sitio Web</button>
                </section>

                <button class="save-btn" onclick="saveChanges()">üíæ Guardar Cambios</button>
            </div>
        </div>
    </div>

    <script>
        // ===============================
        // SISTEMA DE AUTENTICACI√ìN SIMPLIFICADO
        // ===============================

        // Configurar Netlify Identity
        function setupNetlifyIdentity() {
            if (typeof window.netlifyIdentity !== 'undefined') {
                // Limpiar listeners previos para evitar duplicaci√≥n
                window.netlifyIdentity.off('init');
                window.netlifyIdentity.off('login');
                window.netlifyIdentity.off('logout');

                window.netlifyIdentity.on('init', (user) => {
                    console.log('üîê Netlify Identity inicializado');
                    if (user) {
                        console.log('‚úÖ Usuario ya autenticado:', user.email);
                        showAdminPanel(user);
                    } else {
                        console.log('üë§ No hay usuario autenticado - mostrando login');
                        showLoginScreen();
                    }
                });

                window.netlifyIdentity.on('login', (user) => {
                    console.log('‚úÖ Login exitoso:', user.email);
                    showAdminPanel(user);
                });

                window.netlifyIdentity.on('logout', () => {
                    console.log('üö™ Usuario cerr√≥ sesi√≥n');
                    showLoginScreen();
                });

                // Inicializar widget
                window.netlifyIdentity.init();
            } else {
                console.error('‚ùå Netlify Identity widget no est√° disponible');
            }
        }

        // Mostrar panel de administraci√≥n
        function showAdminPanel(user) {
            document.getElementById('auth-wrapper').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('user-email').textContent = user.email;
            
            // Ejecutar OAuth verification una sola vez
            if (window.runOAuthVerification) {
                window.runOAuthVerification();
            }
        }

        // Mostrar pantalla de login
        function showLoginScreen() {
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('auth-wrapper').style.display = 'flex';
        }

        // Funci√≥n de login
        function handleLogin() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.open('login');
            }
        }

        // Funci√≥n de logout
        function logout() {
            if (window.netlifyIdentity) {
                window.netlifyIdentity.logout();
            }
        }

        // ===============================
        // FUNCIONES DEL ADMIN PANEL
        // ===============================

        // Navegaci√≥n entre secciones
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remover clase active de todos los botones
            document.querySelectorAll('.admin-nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar secci√≥n seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Activar bot√≥n correspondiente
            event.target.classList.add('active');
        }

        // Agregar servicio
        function addService() {
            const servicesList = document.getElementById('services-list');
            const serviceIndex = servicesList.children.length;
            
            const serviceDiv = document.createElement('div');
            serviceDiv.className = 'list-item';
            serviceDiv.innerHTML = `
                <h4>Servicio ${serviceIndex + 1}</h4>
                <div class="form-group">
                    <label>Nombre del Servicio</label>
                    <input type="text" id="service-name-${serviceIndex}" placeholder="Nombre del servicio">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="service-description-${serviceIndex}" rows="3" placeholder="Descripci√≥n del servicio"></textarea>
                </div>
                <div class="form-group">
                    <label>Precio</label>
                    <input type="text" id="service-price-${serviceIndex}" placeholder="Precio del servicio">
                </div>
                <button class="remove-btn" onclick="removeService(${serviceIndex})">Eliminar</button>
            `;
            
            servicesList.appendChild(serviceDiv);
        }

        // Eliminar servicio
        function removeService(index) {
            document.getElementById('services-list').children[index].remove();
        }

        // Agregar proyecto de portfolio
        function addPortfolioItem() {
            const portfolioList = document.getElementById('portfolio-list');
            const itemIndex = portfolioList.children.length;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'list-item';
            itemDiv.innerHTML = `
                <h4>Proyecto ${itemIndex + 1}</h4>
                <div class="form-group">
                    <label>T√≠tulo del Proyecto</label>
                    <input type="text" id="portfolio-title-${itemIndex}" placeholder="T√≠tulo del proyecto">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="portfolio-description-${itemIndex}" rows="3" placeholder="Descripci√≥n del proyecto"></textarea>
                </div>
                <div class="form-group">
                    <label>Imagen del Proyecto</label>
                    <input type="file" id="portfolio-image-${itemIndex}" accept="image/*" onchange="uploadImage('portfolio-image-${itemIndex}', ${itemIndex}, 'portfolio')">
                    <img id="portfolio-image-${itemIndex}-preview" class="image-preview" style="display: none;">
                </div>
                <div class="form-group">
                    <label>URL del Proyecto (opcional)</label>
                    <input type="url" id="portfolio-url-${itemIndex}" placeholder="https://ejemplo.com">
                </div>
                <button class="remove-btn" onclick="removePortfolioItem(${itemIndex})">Eliminar</button>
            `;
            
            portfolioList.appendChild(itemDiv);
        }

        // Eliminar proyecto de portfolio
        function removePortfolioItem(index) {
            document.getElementById('portfolio-list').children[index].remove();
        }

        // Agregar post de blog
        function addBlogPost() {
            const blogList = document.getElementById('blog-list');
            const postIndex = blogList.children.length;
            
            const postDiv = document.createElement('div');
            postDiv.className = 'list-item';
            postDiv.innerHTML = `
                <h4>Post ${postIndex + 1}</h4>
                <div class="form-group">
                    <label>T√≠tulo del Post</label>
                    <input type="text" id="blog-title-${postIndex}" placeholder="T√≠tulo del art√≠culo">
                </div>
                <div class="form-group">
                    <label>Contenido</label>
                    <textarea id="blog-content-${postIndex}" rows="6" placeholder="Contenido del art√≠culo"></textarea>
                </div>
                <div class="form-group">
                    <label>Imagen del Post</label>
                    <input type="file" id="blog-image-${postIndex}" accept="image/*" onchange="uploadImage('blog-image-${postIndex}', ${postIndex}, 'blog')">
                    <img id="blog-image-${postIndex}-preview" class="image-preview" style="display: none;">
                </div>
                <div class="form-group">
                    <label>Fecha de Publicaci√≥n</label>
                    <input type="date" id="blog-date-${postIndex}">
                </div>
                <button class="remove-btn" onclick="removeBlogPost(${postIndex})">Eliminar</button>
            `;
            
            blogList.appendChild(postDiv);
        }

        // Eliminar post de blog
        function removeBlogPost(index) {
            document.getElementById('blog-list').children[index].remove();
        }

        // Subir imagen (placeholder - implementar seg√∫n necesidades)
        function uploadImage(inputId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(inputId + '-preview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Guardar cambios (placeholder - implementar l√≥gica de guardado)
        function saveChanges() {
            // Aqu√≠ ir√≠a la l√≥gica para guardar los datos
            // Por ahora, solo muestra un mensaje
            alert('Los cambios se guardar√≠an aqu√≠. Implementar seg√∫n necesidades.');
        }

        // ===============================
        // INICIALIZACI√ìN
        // ===============================

        // Configurar Netlify Identity cuando la p√°gina est√© lista
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando admin panel...');
            
            // Configurar bot√≥n de login
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            
            // Configurar Netlify Identity
            setTimeout(setupNetlifyIdentity, 1000);
        });
    </script>
</body>
</html>
