<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Fotograf√≠a Portfolio</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-box h1 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .login-box p {
            margin-bottom: 30px;
            color: #666;
        }

        #admin-panel {
            display: none;
        }

        .admin-container {
            min-height: 100vh;
            background: #f5f6fa;
        }

        .admin-header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            color: #667eea;
            font-size: 1.8rem;
        }

        .admin-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .admin-content {
            display: flex;
            height: calc(100vh - 80px);
        }

        .admin-sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .admin-nav {
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            background: #f8f9fa;
            border-left-color: #667eea;
        }

        .nav-item.active {
            background: #f0f2ff;
            border-left-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .admin-main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .section-description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .section-description h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .section-description p {
            color: #666;
            line-height: 1.6;
        }

        .image-upload-container {
            border: 2px dashed #ccc;
            border-radius: 6px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .image-upload-container:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .image-upload-container.dragover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 6px;
            margin: 15px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .image-preview.large {
            max-width: 400px;
            max-height: 300px;
        }

        .dynamic-list {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            margin-top: 15px;
        }

        .dynamic-item {
            padding: 20px;
            border-bottom: 1px solid #e1e8ed;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: start;
        }

        .dynamic-item:last-child {
            border-bottom: none;
        }

        .dynamic-item-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .dynamic-item-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .add-item-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background: #229954;
            transform: translateY(-1px);
        }

        .status-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .status-message.show {
            transform: translateX(0);
        }

        .status-message.success {
            background: #27ae60;
        }

        .status-message.error {
            background: #e74c3c;
        }

        .status-message.info {
            background: #667eea;
        }

        .save-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-top: 30px;
        }

        .save-section h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .save-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-btn:hover:not(:disabled) {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .admin-content {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                height: auto;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .dynamic-item {
                grid-template-columns: 1fr;
            }
            
            .dynamic-item-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <h1>üé® Panel de Administraci√≥n</h1>
            <p>Accede con tu cuenta de GitHub para gestionar el contenido de tu portfolio de fotograf√≠a</p>
            <div data-netlify-identity-button="github" class="github-sign-in"></div>
            <button onclick="forceLogin()" class="btn btn-primary" style="margin-top: 20px;">üöÄ Iniciar Sesi√≥n</button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="admin-container">
        <div class="admin-header">
            <h1>üé® Panel de Administraci√≥n - Fotograf√≠a Portfolio</h1>
            <div class="admin-actions">
                <div class="user-info">
                    <span id="user-email"></span>
                </div>
                <button onclick="logout()" class="btn btn-danger">Cerrar Sesi√≥n</button>
            </div>
        </div>

        <div class="admin-content">
            <div class="admin-sidebar">
                <div class="admin-nav">
                    <div class="nav-item active" onclick="switchSection('general')">
                        <strong>‚öôÔ∏è Configuraci√≥n General</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('hero')">
                        <strong>üè† Hero Section</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('photographer')">
                        <strong>üì∑ Sobre el Fot√≥grafo</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('services')">
                        <strong>‚ö° Servicios</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('portfolio')">
                        <strong>üé® Portfolio</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('blog')">
                        <strong>üìù Blog</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('contact')">
                        <strong>üìß Contacto</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('footer')">
                        <strong>ü¶∂ Footer</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('social')">
                        <strong>üåê Redes Sociales</strong>
                    </div>
                    <div class="nav-item" onclick="switchSection('save')">
                        <strong>üíæ Guardar</strong>
                    </div>
                </div>
            </div>

            <div class="admin-main">
                <!-- Configuraci√≥n General -->
                <div id="section-general" class="section active">
                    <h2 class="section-title">‚öôÔ∏è Configuraci√≥n General</h2>
                    <div class="section-description">
                        <h3>Configuraci√≥n del sitio web</h3>
                        <p>Personaliza la informaci√≥n b√°sica de tu sitio web de fotograf√≠a.</p>
                    </div>
                    <form id="general-form">
                        <div class="form-group">
                            <label for="site-title-input">T√≠tulo del Sitio</label>
                            <input type="text" id="site-title-input" placeholder="Estudio de Fotograf√≠a">
                        </div>
                        <div class="form-group">
                            <label for="page-title-input">T√≠tulo de la P√°gina</label>
                            <input type="text" id="page-title-input" placeholder="Estudio de Fotograf√≠a">
                        </div>
                        <div class="form-group">
                            <label for="website-input">Sitio Web</label>
                            <input type="url" id="website-input" placeholder="https://tu-sitio.com">
                        </div>
                    </form>
                </div>

                <!-- Hero Section -->
                <div id="section-hero" class="section">
                    <h2 class="section-title">üè† Hero Section</h2>
                    <div class="section-description">
                        <h3>P√°gina principal</h3>
                        <p>Configura el mensaje principal que ver√°n los visitantes al llegar a tu sitio.</p>
                    </div>
                    <form id="hero-form">
                        <div class="form-group">
                            <label for="hero-title-input">T√≠tulo Principal</label>
                            <input type="text" id="hero-title-input" placeholder="Capturando Momentos √önicos">
                        </div>
                        <div class="form-group">
                            <label for="hero-subtitle-input">Subt√≠tulo</label>
                            <textarea id="hero-subtitle-input" placeholder="Fotograf√≠a profesional que transforma tus momentos especiales..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="hero-cta-input">Texto del Bot√≥n</label>
                            <input type="text" id="hero-cta-input" placeholder="Ver Mi Portfolio">
                        </div>
                        
                        <div class="form-group">
                            <label>Imagen del Hero</label>
                            <div class="image-upload-container" onclick="document.getElementById('hero-image-input').click()">
                                <div id="hero-image-preview">
                                    <p>üì∑ Haz clic para subir una imagen del Hero</p>
                                    <small>Se recomienda una imagen panor√°mica (1920x1080)</small>
                                </div>
                            </div>
                            <input type="file" id="hero-image-input" accept="image/*" style="display: none;" onchange="handleImageUpload('hero-image-input', 'hero-image-preview')">
                        </div>
                    </form>
                </div>

                <!-- Sobre el Fot√≥grafo -->
                <div id="section-photographer" class="section">
                    <h2 class="section-title">üì∑ Sobre el Fot√≥grafo</h2>
                    <div class="section-description">
                        <h3>Informaci√≥n personal</h3>
                        <p>Comparte tu historia, experiencia y filosof√≠a como fot√≥grafo.</p>
                    </div>
                    <form id="photographer-form">
                        <div class="form-group">
                            <label for="photographer-name-input">Nombre del Fot√≥grafo</label>
                            <input type="text" id="photographer-name-input" placeholder="Carlos Mart√≠nez">
                        </div>
                        <div class="form-group">
                            <label for="photographer-specialty-input">Especialidad</label>
                            <input type="text" id="photographer-specialty-input" placeholder="Fotograf√≠a de Retratos y Eventos">
                        </div>
                        <div class="form-group">
                            <label for="photographer-experience-input">Experiencia</label>
                            <input type="text" id="photographer-experience-input" placeholder="8 a√±os de experiencia">
                        </div>
                        <div class="form-group">
                            <label for="photographer-bio-input">Biograf√≠a</label>
                            <textarea id="photographer-bio-input" placeholder="Tu historia como fot√≥grafo, experiencia, logros..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Foto del Fot√≥grafo</label>
                            <div class="image-upload-container" onclick="document.getElementById('photographer-image-input').click()">
                                <div id="photographer-image-preview">
                                    <p>üì∑ Haz clic para subir la foto del fot√≥grafo</p>
                                    <small>Se recomienda una foto de perfil (400x400)</small>
                                </div>
                            </div>
                            <input type="file" id="photographer-image-input" accept="image/*" style="display: none;" onchange="handleImageUpload('photographer-image-input', 'photographer-image-preview')">
                        </div>
                    </form>
                </div>

                <!-- Servicios -->
                <div id="section-services" class="section">
                    <h2 class="section-title">‚ö° Servicios</h2>
                    <div class="section-description">
                        <h3>Servicios fotogr√°ficos</h3>
                        <p>Lista los servicios que ofreces con sus descripciones.</p>
                    </div>
                    <div id="services-list" class="dynamic-list">
                        <!-- Servicios se cargar√°n din√°micamente -->
                    </div>
                    <button onclick="addService()" class="add-item-btn">‚ûï A√±adir Servicio</button>
                </div>

                <!-- Portfolio -->
                <div id="section-portfolio" class="section">
                    <h2 class="section-title">üé® Portfolio</h2>
                    <div class="section-description">
                        <h3>Trabajos destacados</h3>
                        <p>Muestra tus mejores fotograf√≠as organizadas por categor√≠as.</p>
                    </div>
                    <div id="portfolio-list" class="dynamic-list">
                        <!-- Portfolio se cargar√° din√°micamente -->
                    </div>
                    <button onclick="addPortfolioItem()" class="add-item-btn">‚ûï A√±adir Trabajo</button>
                </div>

                <!-- Blog -->
                <div id="section-blog" class="section">
                    <h2 class="section-title">üìù Blog</h2>
                    <div class="section-description">
                        <h3>Art√≠culos y noticias</h3>
                        <p>Comparte historias, consejos y noticias sobre fotograf√≠a.</p>
                    </div>
                    <div id="blog-list" class="dynamic-list">
                        <!-- Blog se cargar√° din√°micamente -->
                    </div>
                    <button onclick="addBlogPost()" class="add-item-btn">‚ûï A√±adir Art√≠culo</button>
                </div>

                <!-- Contacto -->
                <div id="section-contact" class="section">
                    <h2 class="section-title">üìß Contacto</h2>
                    <div class="section-description">
                        <h3>Informaci√≥n de contacto</h3>
                        <p>Proporciona formas para que los clientes puedan contactarte.</p>
                    </div>
                    <form id="contact-form">
                        <div class="form-group">
                            <label for="contact-email-input">Email</label>
                            <input type="email" id="contact-email-input" placeholder="carlos@fotografia-martinez.com">
                        </div>
                        <div class="form-group">
                            <label for="contact-phone-input">Tel√©fono</label>
                            <input type="tel" id="contact-phone-input" placeholder="+34 678 123 456">
                        </div>
                        <div class="form-group">
                            <label for="contact-address-input">Direcci√≥n</label>
                            <input type="text" id="contact-address-input" placeholder="Calle Fot√≥grafos 15, Madrid 28001">
                        </div>
                        <div class="form-group">
                            <label for="contact-studio-input">Estudio</label>
                            <input type="text" id="contact-studio-input" placeholder="Estudio fotogr√°fico con iluminaci√≥n profesional">
                        </div>
                        <div class="form-group">
                            <label for="contact-availability-input">Horario</label>
                            <input type="text" id="contact-availability-input" placeholder="Lunes a S√°bado - 9:00 a 20:00">
                        </div>
                    </form>
                </div>

                <!-- Footer -->
                <div id="section-footer" class="section">
                    <h2 class="section-title">ü¶∂ Footer</h2>
                    <div class="section-description">
                        <h3>Informaci√≥n del pie de p√°gina</h3>
                        <p>Personaliza el contenido del footer de tu sitio web.</p>
                    </div>
                    <form id="footer-form">
                        <div class="form-group">
                            <label for="footer-title-input">T√≠tulo del Footer</label>
                            <input type="text" id="footer-title-input" placeholder="Estudio de Fotograf√≠a">
                        </div>
                        <div class="form-group">
                            <label for="footer-description-input">Descripci√≥n</label>
                            <textarea id="footer-description-input" placeholder="Capturando momentos √∫nicos con pasi√≥n y profesionalismo"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="copyright-input">Texto de Copyright</label>
                            <textarea id="copyright-input" placeholder="&copy; 2025 Estudio de Fotograf√≠a Carlos Mart√≠nez. Todos los derechos reservados."></textarea>
                        </div>
                    </form>
                </div>

                <!-- Redes Sociales -->
                <div id="section-social" class="section">
                    <h2 class="section-title">üåê Redes Sociales</h2>
                    <div class="section-description">
                        <h3>Enlaces de redes sociales</h3>
                        <p>Configura los enlaces a tus perfiles en redes sociales.</p>
                    </div>
                    <form id="social-form">
                        <div class="form-group">
                            <label for="instagram-link-input">Instagram</label>
                            <input type="url" id="instagram-link-input" placeholder="https://instagram.com/carlos_fotografo">
                        </div>
                        <div class="form-group">
                            <label for="facebook-link-input">Facebook</label>
                            <input type="url" id="facebook-link-input" placeholder="https://facebook.com/carlos.fotografo">
                        </div>
                        <div class="form-group">
                            <label for="twitter-link-input">Twitter</label>
                            <input type="url" id="twitter-link-input" placeholder="https://twitter.com/carlos_fotografo">
                        </div>
                        <div class="form-group">
                            <label for="linkedin-link-input">LinkedIn</label>
                            <input type="url" id="linkedin-link-input" placeholder="https://linkedin.com/in/carlos-martinez-fotografo">
                        </div>
                        <div class="form-group">
                            <label for="website-link-input">Sitio Web</label>
                            <input type="url" id="website-link-input" placeholder="https://carlosmartinez-fotografia.com">
                        </div>
                    </form>
                </div>

                <!-- Guardar -->
                <div id="section-save" class="section">
                    <h2 class="section-title">üíæ Guardar Cambios</h2>
                    <div class="section-description">
                        <h3>Guardar todos los cambios</h3>
                        <p>Haz clic para guardar todos los cambios en tu sitio web.</p>
                    </div>
                    <div class="save-section">
                        <h3>üíæ Guardar Todos los Cambios</h3>
                        <p>Esta acci√≥n guardar√° todos los datos en tu repositorio de GitHub.</p>
                        <button id="save-btn" onclick="saveChanges()" class="save-btn">üíæ Guardar Cambios</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Message -->
    <div id="status-message" class="status-message"></div>

    <script>
        // Variables globales
        let currentUser = null;
        let isInitialized = false;
        let siteData = {};
        let imageUploads = {}; // Para manejar subida de im√°genes

        // Funci√≥n para manejar subida de im√°genes
        function handleImageUpload(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Mostrar preview
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="image-preview large" alt="Preview">
                        <p>‚úÖ Imagen cargada: ${file.name}</p>
                    `;
                    // Guardar la imagen en el objeto de uploads
                    imageUploads[inputId] = {
                        file: file,
                        name: file.name,
                        type: file.type
                    };
                    console.log('üì∑ Imagen seleccionada:', file.name);
                };
                reader.readAsDataURL(file);
            }
        }

        // Funci√≥n para subir imagen a Netlify
        async function uploadImage(imageData) {
            try {
                const formData = new FormData();
                formData.append('image', imageData.file, imageData.name);
                
                const response = await fetch('/.netlify/functions/upload-image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    console.log('‚úÖ Imagen subida:', result.url);
                    return result.url;
                } else {
                    throw new Error(result.error || 'Error subiendo imagen');
                }
            } catch (error) {
                console.error('‚ùå Error subiendo imagen:', error);
                return null;
            }
        }

        // Funci√≥n para forzar login
        function forceLogin() {
            if (netlifyIdentity) {
                netlifyIdentity.open();
            } else {
                console.error('Netlify Identity no est√° disponible');
            }
        }

        // Funci√≥n para logout
        function logout() {
            if (netlifyIdentity) {
                netlifyIdentity.logout();
            }
        }

        // Funci√≥n para mostrar/ocultar secciones
        function switchSection(sectionName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar secci√≥n seleccionada
            document.getElementById(`section-${sectionName}`).classList.add('active');
            
            // Actualizar navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            event.target.classList.add('active');
        }

        // Funci√≥n para a√±adir un servicio
        function addService() {
            const container = document.getElementById('services-list');
            const serviceId = Date.now();
            const serviceHTML = `
                <div class="dynamic-item" data-service-id="${serviceId}">
                    <div class="dynamic-item-content">
                        <div class="form-group">
                            <label>T√≠tulo del Servicio</label>
                            <input type="text" id="service-title-${serviceId}" placeholder="Fotograf√≠a de Bodas">
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="service-description-${serviceId}" placeholder="Descripci√≥n del servicio..."></textarea>
                        </div>
                    </div>
                    <div class="dynamic-item-actions">
                        <button onclick="removeService(${serviceId})" class="btn btn-danger btn-small">Eliminar</button>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', serviceHTML);
        }

        // Funci√≥n para eliminar un servicio
        function removeService(serviceId) {
            const element = document.querySelector(`[data-service-id="${serviceId}"]`);
            if (element) {
                element.remove();
            }
        }

        // Funci√≥n para a√±adir un trabajo de portfolio
        function addPortfolioItem() {
            const container = document.getElementById('portfolio-list');
            const portfolioId = Date.now();
            const portfolioHTML = `
                <div class="dynamic-item" data-portfolio-id="${portfolioId}">
                    <div class="dynamic-item-content">
                        <div class="form-group">
                            <label>T√≠tulo</label>
                            <input type="text" id="portfolio-title-${portfolioId}" placeholder="Sesi√≥n en la playa">
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="portfolio-description-${portfolioId}" placeholder="Describe el proyecto..."></textarea>
                        </div>
                    </div>
                    <div class="dynamic-item-content">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Imagen</label>
                            <div class="image-upload-container" onclick="document.getElementById('portfolio-image-${portfolioId}').click()">
                                <div id="portfolio-image-preview-${portfolioId}">
                                    <p>üì∑ Haz clic para subir imagen</p>
                                </div>
                            </div>
                            <input type="file" id="portfolio-image-${portfolioId}" accept="image/*" style="display: none;" onchange="handleImageUpload('portfolio-image-${portfolioId}', 'portfolio-image-preview-${portfolioId}')">
                        </div>
                    </div>
                    <div class="dynamic-item-actions">
                        <button onclick="removePortfolioItem(${portfolioId})" class="btn btn-danger btn-small">Eliminar</button>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', portfolioHTML);
        }

        // Funci√≥n para eliminar un trabajo de portfolio
        function removePortfolioItem(portfolioId) {
            const element = document.querySelector(`[data-portfolio-id="${portfolioId}"]`);
            if (element) {
                element.remove();
            }
        }

        // Funci√≥n para a√±adir un art√≠culo de blog
        function addBlogPost() {
            const container = document.getElementById('blog-list');
            const blogId = Date.now();
            const blogHTML = `
                <div class="dynamic-item" data-blog-id="${blogId}">
                    <div class="dynamic-item-content">
                        <div class="form-group">
                            <label>T√≠tulo</label>
                            <input type="text" id="blog-title-${blogId}" placeholder="Consejos para fotograf√≠a de retratos">
                        </div>
                        <div class="form-group">
                            <label>Fecha</label>
                            <input type="date" id="blog-date-${blogId}">
                        </div>
                    </div>
                    <div class="dynamic-item-content">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Contenido</label>
                            <textarea id="blog-content-${blogId}" placeholder="Escribe tu art√≠culo..." style="min-height: 120px;"></textarea>
                        </div>
                    </div>
                    <div class="dynamic-item-actions">
                        <button onclick="removeBlogPost(${blogId})" class="btn btn-danger btn-small">Eliminar</button>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', blogHTML);
        }

        // Funci√≥n para eliminar un art√≠culo de blog
        function removeBlogPost(blogId) {
            const element = document.querySelector(`[data-blog-id="${blogId}"]`);
            if (element) {
                element.remove();
            }
        }

        // Funci√≥n para mostrar mensajes de estado
        function showStatus(message, type = 'info') {
            const statusElement = document.getElementById('status-message');
            statusElement.textContent = message;
            statusElement.className = `status-message ${type} show`;
            
            setTimeout(() => {
                statusElement.classList.remove('show');
            }, 5000);
        }

        // Funci√≥n para obtener el token JWT
        function getJWTToken(user) {
            console.log('üîç Analizando token del usuario...', user);
            
            if (!user) {
                console.log('‚ùå No hay usuario logueado');
                return null;
            }

            let token = null;

            if (user.token && user.token.access_token) {
                token = user.token.access_token;
                console.log('‚úÖ Token obtenido de user.token.access_token');
            }
            else if (user.jwt) {
                token = user.jwt;
                console.log('‚úÖ Token obtenido de user.jwt');
            }
            else if (user.token && user.token.token) {
                token = user.token.token;
                console.log('‚úÖ Token obtenido de user.token.token');
            }
            else if (user.access_token) {
                token = user.access_token;
                console.log('‚úÖ Token obtenido de user.access_token');
            }
            else {
                const identityData = localStorage.getItem('netlify-identity.user');
                if (identityData) {
                    try {
                        const parsed = JSON.parse(identityData);
                        if (parsed.token && parsed.token.access_token) {
                            token = parsed.token.access_token;
                            console.log('‚úÖ Token obtenido de localStorage');
                        }
                    } catch (e) {
                        console.log('‚ùå Error parseando localStorage:', e);
                    }
                }
            }

            if (token) {
                console.log('üîë Token encontrado. Longitud:', token.length);
                console.log('üîë Token (primeros 50 caracteres):', token.substring(0, 50) + '...');
                return token;
            } else {
                console.log('‚ùå No se pudo obtener el token');
                console.log('üìã Propiedades del usuario:', Object.keys(user));
                return null;
            }
        }

        // Funci√≥n para recoger datos del formulario
        function collectFormData() {
            // Servicios
            const services = [];
            document.querySelectorAll('[data-service-id]').forEach(item => {
                const serviceId = item.dataset.serviceId;
                const title = document.getElementById(`service-title-${serviceId}`)?.value || '';
                const description = document.getElementById(`service-description-${serviceId}`)?.value || '';
                
                if (title.trim()) {
                    services.push({ title, description });
                }
            });

            // Portfolio
            const portfolio = [];
            document.querySelectorAll('[data-portfolio-id]').forEach(item => {
                const portfolioId = item.dataset.portfolioId;
                const title = document.getElementById(`portfolio-title-${portfolioId}`)?.value || '';
                const description = document.getElementById(`portfolio-description-${portfolioId}`)?.value || '';
                
                if (title.trim()) {
                    portfolio.push({ title, description });
                }
            });

            // Blog
            const blog = [];
            document.querySelectorAll('[data-blog-id]').forEach(item => {
                const blogId = item.dataset.blogId;
                const title = document.getElementById(`blog-title-${blogId}`)?.value || '';
                const date = document.getElementById(`blog-date-${blogId}`)?.value || '';
                const content = document.getElementById(`blog-content-${blogId}`)?.value || '';
                
                if (title.trim()) {
                    blog.push({ title, date, content });
                }
            });

            return {
                site: {
                    title: document.getElementById('site-title-input').value || '',
                    page_title: document.getElementById('page-title-input').value || '',
                    website: document.getElementById('website-input').value || ''
                },
                hero: {
                    title: document.getElementById('hero-title-input').value || '',
                    subtitle: document.getElementById('hero-subtitle-input').value || '',
                    cta: document.getElementById('hero-cta-input').value || ''
                },
                photographer: {
                    name: document.getElementById('photographer-name-input').value || '',
                    specialty: document.getElementById('photographer-specialty-input').value || '',
                    experience: document.getElementById('photographer-experience-input').value || '',
                    bio: document.getElementById('photographer-bio-input').value || ''
                },
                services: services,
                portfolio: portfolio,
                blog: blog,
                contact: {
                    email: document.getElementById('contact-email-input').value || '',
                    phone: document.getElementById('contact-phone-input').value || '',
                    address: document.getElementById('contact-address-input').value || '',
                    studio: document.getElementById('contact-studio-input').value || '',
                    availability: document.getElementById('contact-availability-input').value || ''
                },
                footer: {
                    title: document.getElementById('footer-title-input').value || '',
                    description: document.getElementById('footer-description-input').value || '',
                    copyright: document.getElementById('copyright-input').value || ''
                },
                social: {
                    instagram: document.getElementById('instagram-link-input').value || '',
                    facebook: document.getElementById('facebook-link-input').value || '',
                    twitter: document.getElementById('twitter-link-input').value || '',
                    linkedin: document.getElementById('linkedin-link-input').value || '',
                    website: document.getElementById('website-link-input').value || ''
                }
            };
        }

        // Funci√≥n para cargar datos en los formularios
        function loadFormData(data) {
            // Datos generales
            document.getElementById('site-title-input').value = data.site?.title || '';
            document.getElementById('page-title-input').value = data.site?.page_title || '';
            document.getElementById('website-input').value = data.site?.website || '';

            // Hero
            document.getElementById('hero-title-input').value = data.hero?.title || '';
            document.getElementById('hero-subtitle-input').value = data.hero?.subtitle || '';
            document.getElementById('hero-cta-input').value = data.hero?.cta || '';

            // Fot√≥grafo
            document.getElementById('photographer-name-input').value = data.photographer?.name || '';
            document.getElementById('photographer-specialty-input').value = data.photographer?.specialty || '';
            document.getElementById('photographer-experience-input').value = data.photographer?.experience || '';
            document.getElementById('photographer-bio-input').value = data.photographer?.bio || '';

            // Contacto
            document.getElementById('contact-email-input').value = data.contact?.email || '';
            document.getElementById('contact-phone-input').value = data.contact?.phone || '';
            document.getElementById('contact-address-input').value = data.contact?.address || '';
            document.getElementById('contact-studio-input').value = data.contact?.studio || '';
            document.getElementById('contact-availability-input').value = data.contact?.availability || '';

            // Footer
            document.getElementById('footer-title-input').value = data.footer?.title || '';
            document.getElementById('footer-description-input').value = data.footer?.description || '';
            document.getElementById('copyright-input').value = data.footer?.copyright || '';

            // Social
            document.getElementById('instagram-link-input').value = data.social?.instagram || '';
            document.getElementById('facebook-link-input').value = data.social?.facebook || '';
            document.getElementById('twitter-link-input').value = data.social?.twitter || '';
            document.getElementById('linkedin-link-input').value = data.social?.linkedin || '';
            document.getElementById('website-link-input').value = data.social?.website || '';

            // Servicios
            const servicesContainer = document.getElementById('services-list');
            servicesContainer.innerHTML = '';
            if (data.services && Array.isArray(data.services)) {
                data.services.forEach(service => {
                    const serviceId = Date.now() + Math.random();
                    const serviceHTML = `
                        <div class="dynamic-item" data-service-id="${serviceId}">
                            <div class="dynamic-item-content">
                                <div class="form-group">
                                    <label>T√≠tulo del Servicio</label>
                                    <input type="text" id="service-title-${serviceId}" value="${service.title || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Descripci√≥n</label>
                                    <textarea id="service-description-${serviceId}">${service.description || ''}</textarea>
                                </div>
                            </div>
                            <div class="dynamic-item-actions">
                                <button onclick="removeService(${serviceId})" class="btn btn-danger btn-small">Eliminar</button>
                            </div>
                        </div>
                    `;
                    servicesContainer.insertAdjacentHTML('beforeend', serviceHTML);
                });
            }

            // Portfolio
            const portfolioContainer = document.getElementById('portfolio-list');
            portfolioContainer.innerHTML = '';
            if (data.portfolio && Array.isArray(data.portfolio)) {
                data.portfolio.forEach(item => {
                    const portfolioId = Date.now() + Math.random();
                    const portfolioHTML = `
                        <div class="dynamic-item" data-portfolio-id="${portfolioId}">
                            <div class="dynamic-item-content">
                                <div class="form-group">
                                    <label>T√≠tulo</label>
                                    <input type="text" id="portfolio-title-${portfolioId}" value="${item.title || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Descripci√≥n</label>
                                    <textarea id="portfolio-description-${portfolioId}">${item.description || ''}</textarea>
                                </div>
                            </div>
                            <div class="dynamic-item-content">
                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label>Imagen</label>
                                    <div class="image-upload-container" onclick="document.getElementById('portfolio-image-${portfolioId}').click()">
                                        <div id="portfolio-image-preview-${portfolioId}">
                                            <p>üì∑ Haz clic para subir imagen</p>
                                        </div>
                                    </div>
                                    <input type="file" id="portfolio-image-${portfolioId}" accept="image/*" style="display: none;" onchange="handleImageUpload('portfolio-image-${portfolioId}', 'portfolio-image-preview-${portfolioId}')">
                                </div>
                            </div>
                            <div class="dynamic-item-actions">
                                <button onclick="removePortfolioItem(${portfolioId})" class="btn btn-danger btn-small">Eliminar</button>
                            </div>
                        </div>
                    `;
                    portfolioContainer.insertAdjacentHTML('beforeend', portfolioHTML);
                });
            }

            // Blog
            const blogContainer = document.getElementById('blog-list');
            blogContainer.innerHTML = '';
            if (data.blog && Array.isArray(data.blog)) {
                data.blog.forEach(post => {
                    const blogId = Date.now() + Math.random();
                    const blogHTML = `
                        <div class="dynamic-item" data-blog-id="${blogId}">
                            <div class="dynamic-item-content">
                                <div class="form-group">
                                    <label>T√≠tulo</label>
                                    <input type="text" id="blog-title-${blogId}" value="${post.title || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Fecha</label>
                                    <input type="date" id="blog-date-${blogId}" value="${post.date || ''}">
                                </div>
                            </div>
                            <div class="dynamic-item-content">
                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label>Contenido</label>
                                    <textarea id="blog-content-${blogId}" style="min-height: 120px;">${post.content || ''}</textarea>
                                </div>
                            </div>
                            <div class="dynamic-item-actions">
                                <button onclick="removeBlogPost(${blogId})" class="btn btn-danger btn-small">Eliminar</button>
                            </div>
                        </div>
                    `;
                    blogContainer.insertAdjacentHTML('beforeend', blogHTML);
                });
            }
        }

        // Funci√≥n para guardar cambios (MEJORADA)
        async function saveChanges() {
            const saveBtn = document.getElementById('save-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = '‚è≥ Guardando...';
            
            try {
                console.log('üíæ Iniciando proceso de guardado...');
                
                // Recoger datos del formulario
                const formData = collectFormData();
                console.log('üìã Datos recopilados:', Object.keys(formData));
                
                // Subir im√°genes primero
                console.log('üì∑ Subiendo im√°genes...');
                for (const [key, imageData] of Object.entries(imageUploads)) {
                    if (imageData.file) {
                        const imageUrl = await uploadImage(imageData);
                        if (imageUrl) {
                            // Asignar URL seg√∫n el tipo de input
                            if (key === 'hero-image-input') {
                                formData.hero.image = imageUrl;
                            } else if (key === 'photographer-image-input') {
                                formData.photographer.image = imageUrl;
                            } else if (key.startsWith('portfolio-image-')) {
                                const portfolioId = key.replace('portfolio-image-', '');
                                const portfolioItem = formData.portfolio.find(p => p.id === portfolioId);
                                if (portfolioItem) {
                                    portfolioItem.image = imageUrl;
                                }
                            }
                        }
                    }
                }
                
                // Obtener token
                const token = getJWTToken(currentUser);
                
                if (!token) {
                    throw new Error('No se pudo obtener el token de autenticaci√≥n. Intenta cerrar sesi√≥n y volver a iniciar sesi√≥n.');
                }
                
                console.log('üöÄ Enviando solicitud a Netlify Function...');
                
                // Enviar a Netlify Function
                const response = await fetch('/.netlify/functions/update-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ siteData: formData })
                });
                
                console.log('üì° Respuesta recibida:', {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries())
                });
                
                // Parsear respuesta
                const result = await response.json();
                console.log('üì¶ Datos de respuesta:', result);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Token de autorizaci√≥n inv√°lido o expirado. Cierra sesi√≥n y vuelve a iniciar sesi√≥n.');
                    } else if (response.status === 403) {
                        throw new Error('No tienes permisos para modificar el repositorio.');
                    } else if (response.status === 404) {
                        throw new Error('El endpoint de guardado no est√° disponible. Verifica la configuraci√≥n de Netlify.');
                    } else {
                        throw new Error(result.error || `Error del servidor: ${response.status} - ${response.statusText}`);
                    }
                }
                
                // √âxito
                console.log('‚úÖ Guardado exitoso:', result);
                showStatus('¬°Cambios guardados exitosamente en GitHub!', 'success');
                
                // Actualizar datos locales
                siteData = { ...siteData, ...formData };
                
                // Limpiar im√°genes subidas
                imageUploads = {};
                
            } catch (error) {
                console.error('‚ùå Error detallado al guardar:', error);
                
                let errorMessage = 'Error desconocido al guardar.';
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'Error de conexi√≥n. Verifica tu conexi√≥n a internet y que el sitio est√© funcionando.';
                } else if (error.message.includes('401')) {
                    errorMessage = 'Error de autenticaci√≥n. Cierra sesi√≥n y vuelve a iniciar sesi√≥n.';
                } else if (error.message.includes('403')) {
                    errorMessage = 'Sin permisos. Verifica que el token tenga acceso al repositorio.';
                } else if (error.message.includes('404')) {
                    errorMessage = 'Endpoint no encontrado. Verifica la configuraci√≥n de Netlify Functions.';
                } else {
                    errorMessage = error.message;
                }
                
                showStatus(`‚ùå ${errorMessage}`, 'error');
            } finally {
                // Rehabilitar bot√≥n
                saveBtn.disabled = false;
                saveBtn.textContent = 'üíæ Guardar Cambios';
            }
        }

        // Funci√≥n para cargar datos del sitio
        async function loadSiteData() {
            try {
                console.log('üìä Cargando datos del sitio...');
                const response = await fetch('/data.json');
                if (response.ok) {
                    siteData = await response.json();
                    loadFormData(siteData);
                    console.log('‚úÖ Datos cargados exitosamente');
                } else {
                    console.warn('‚ö†Ô∏è No se pudo cargar data.json, usando valores por defecto');
                    loadFormData({});
                }
            } catch (error) {
                console.error('‚ùå Error cargando datos:', error);
                loadFormData({});
            }
        }

        // Funciones de debug
        window.debugAdmin = {
            init: () => {
                console.log('üöÄ Admin Panel Completo cargado correctamente. Funciones disponibles:');
                console.log('   - debugAdmin.init()');
                console.log('   - debugAdmin.login()');
                console.log('   - debugAdmin.logout()');
                console.log('   - debugAdmin.switchSection("section")');
                console.log('   - debugAdmin.checkIdentity()');
                console.log('   - debugAdmin.reloadData()');
                console.log('   - debugAdmin.testSave() - Para probar guardado');
                console.log('   - debugAdmin.reset()');
                console.log('');
                console.log('üìã Secciones disponibles:');
                console.log('   - Configuraci√≥n General');
                console.log('   - Hero Section');
                console.log('   - Sobre el Fot√≥grafo');
                console.log('   - Servicios');
                console.log('   - Portfolio');
                console.log('   - Blog');
                console.log('   - Contacto');
                console.log('   - Footer');
                console.log('   - Redes Sociales');
                console.log('   - Guardar');
                console.log('');
                console.log('üöÄ Funcionalidades incluidas:');
                console.log('   - Gesti√≥n de im√°genes (Hero, Fot√≥grafo, Portfolio)');
                console.log('   - Edici√≥n completa del footer y copyright');
                console.log('   - Enlaces sociales completos');
                console.log('   - Compatible con index.html original');
            },
            
            login: () => forceLogin(),
            
            logout: () => logout(),
            
            switchSection: (section) => {
                const navItem = document.querySelector(`[onclick="switchSection('${section}')"]`);
                if (navItem) navItem.click();
            },
            
            checkIdentity: () => {
                console.log('üîç Estado de Netlify Identity:');
                console.log('- Usuario actual:', currentUser);
                console.log('- Inicializado:', isInitialized);
                if (currentUser) {
                    console.log('- Token disponible:', !!getJWTToken(currentUser));
                }
            },
            
            reloadData: () => loadSiteData(),
            
            testSave: async () => {
                console.log('üß™ Probando funci√≥n de guardado...');
                await saveChanges();
            },
            
            reset: () => {
                localStorage.clear();
                sessionStorage.clear();
                location.reload();
            }
        };

        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando Admin Panel Completo Compatible...');
            
            if (typeof netlifyIdentity !== 'undefined') {
                console.log('‚úÖ Netlify Identity disponible');
                
                // Evento de login
                netlifyIdentity.on('login', function(user) {
                    console.log('üîê Usuario logueado:', user.email);
                    currentUser = user;
                    document.getElementById('login-container').style.display = 'none';
                    document.getElementById('admin-panel').style.display = 'block';
                    document.getElementById('user-email').textContent = user.email;
                    
                    if (!isInitialized) {
                        console.log('üîÑ Inicializando panel de administraci√≥n...');
                        loadSiteData();
                        isInitialized = true;
                    }
                });

                // Evento de logout
                netlifyIdentity.on('logout', function() {
                    console.log('üö™ Usuario deslogueado');
                    currentUser = null;
                    isInitialized = false;
                    document.getElementById('login-container').style.display = 'flex';
                    document.getElementById('admin-panel').style.display = 'none';
                });

                // Verificar si ya hay un usuario logueado
                netlifyIdentity.on('init', function(user) {
                    console.log('üîß Netlify Identity inicializado:', user ? 'Usuario autenticado' : 'No autenticado');
                    
                    if (user) {
                        console.log('üîì Mostrando panel de administraci√≥n para:', user.email);
                        currentUser = user;
                        document.getElementById('login-container').style.display = 'none';
                        document.getElementById('admin-panel').style.display = 'block';
                        document.getElementById('user-email').textContent = user.email;
                        
                        if (!isInitialized) {
                            loadSiteData();
                            isInitialized = true;
                        }
                    }
                });
            } else {
                console.error('‚ùå Netlify Identity no est√° disponible');
            }
        });

        console.log('‚úÖ Admin Panel Compatible con index.html cargado correctamente. Funciones disponibles:');
        console.log('   - debugAdmin.init()');
        console.log('   - debugAdmin.login()');
        console.log('   - debugAdmin.logout()');
        console.log('   - debugAdmin.switchSection("section")');
        console.log('   - debugAdmin.checkIdentity()');
        console.log('   - debugAdmin.reloadData()');
        console.log('   - debugAdmin.testSave() - Para probar guardado');
        console.log('   - debugAdmin.reset()');
        console.log('');
        console.log('üìã Secciones disponibles:');
        console.log('   - Configuraci√≥n General');
        console.log('   - Hero Section');
        console.log('   - Sobre el Fot√≥grafo');
        console.log('   - Servicios');
        console.log('   - Portfolio');
        console.log('   - Blog');
        console.log('   - Contacto');
        console.log('   - Footer');
        console.log('   - Redes Sociales');
        console.log('   - Guardar');
        console.log('');
        console.log('üöÄ Funcionalidades incluidas:');
        console.log('   - Gesti√≥n de im√°genes (Hero, Fot√≥grafo, Portfolio)');
        console.log('   - Edici√≥n completa del footer y copyright');
        console.log('   - Enlaces sociales completos');
        console.log('   - Compatible con index.html original');
    </script>
</body>
</html>
