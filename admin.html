<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Fotograf√≠a Portfolio</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-box h1 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .login-box p {
            margin-bottom: 30px;
            color: #666;
        }

        #admin-panel {
            display: none;
            min-height: 100vh;
            background: #f8fafc;
        }

        .admin-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .admin-header h1 {
            color: #2d3748;
            font-size: 1.5rem;
        }

        .admin-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-user-email {
            color: #4a5568;
            font-size: 0.9rem;
        }

        .admin-logout {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .admin-logout:hover {
            background: #c53030;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-nav {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .admin-nav-button {
            background: #edf2f7;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .admin-nav-button:hover {
            background: #e2e8f0;
        }

        .admin-nav-button.active {
            background: #667eea;
            color: white;
        }

        .admin-section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 2rem;
        }

        .admin-section.active {
            display: block;
        }

        .admin-section h2 {
            color: #2d3748;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4a5568;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .image-upload {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .image-upload:hover {
            border-color: #667eea;
        }

        .image-upload.dragover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .items-list {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .item-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr auto;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            align-items: start;
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .item-row input,
        .item-row textarea {
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }

        .item-row button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .add-item {
            background: #38a169;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: background 0.2s;
        }

        .add-item:hover {
            background: #2f855a;
        }

        .admin-save {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 2rem;
            transition: all 0.2s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .admin-save:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .admin-save:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        .save-status {
            text-align: center;
            margin-top: 1rem;
            font-weight: 500;
        }

        .save-status.success {
            color: #38a169;
        }

        .save-status.error {
            color: #e53e3e;
        }

        .debug-info {
            background: #1a202c;
            color: #68d391;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 2rem;
            font-family: monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .debug-info.error {
            background: #742a2a;
            color: #fc8181;
        }

        .social-links-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .item-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .social-links-grid {
                grid-template-columns: 1fr;
            }

            .admin-nav {
                flex-direction: column;
            }

            .admin-nav-button {
                width: 100%;
            }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <h1>Panel de Administraci√≥n</h1>
            <p>Accede con tu cuenta de GitHub para administrar tu portafolio</p>
            <button onclick="initNetlifyIdentity()" class="admin-nav-button">
                Iniciar Sesi√≥n
            </button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel">
        <!-- Header -->
        <div class="admin-header">
            <h1>üì∏ Admin Panel - Fotograf√≠a Portfolio</h1>
            <div class="admin-user">
                <span class="admin-user-email" id="admin-user-email"></span>
                <button class="admin-logout" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="admin-container">
            <!-- Navigation -->
            <div class="admin-nav">
                <button class="admin-nav-button active" onclick="showSection('configuracion-general')">
                    ‚öôÔ∏è Configuraci√≥n General
                </button>
                <button class="admin-nav-button" onclick="showSection('hero-section')">
                    üè† Hero Section
                </button>
                <button class="admin-nav-button" onclick="showSection('sobre-fotografo')">
                    üë§ Sobre el Fot√≥grafo
                </button>
                <button class="admin-nav-button" onclick="showSection('servicios')">
                    üéØ Servicios
                </button>
                <button class="admin-nav-button" onclick="showSection('portfolio')">
                    üñºÔ∏è Portfolio
                </button>
                <button class="admin-nav-button" onclick="showSection('blog')">
                    üìù Blog
                </button>
                <button class="admin-nav-button" onclick="showSection('contacto')">
                    üìû Contacto
                </button>
                <button class="admin-nav-button" onclick="showSection('footer')">
                    üìÑ Footer
                </button>
                <button class="admin-nav-button" onclick="showSection('redes-sociales')">
                    üåê Redes Sociales
                </button>
                <button class="admin-nav-button" onclick="showSection('guardar')">
                    üíæ Guardar
                </button>
            </div>

            <!-- Configuraci√≥n General -->
            <div id="configuracion-general" class="admin-section active">
                <h2>‚öôÔ∏è Configuraci√≥n General</h2>
                <div class="form-group">
                    <label for="site-title">T√≠tulo del Sitio</label>
                    <input type="text" id="site-title" placeholder="Estudio de Fotograf√≠a">
                </div>
                <div class="form-group">
                    <label for="page-title">T√≠tulo de la P√°gina</label>
                    <input type="text" id="page-title" placeholder="Estudio de Fotograf√≠a">
                </div>
            </div>

            <!-- Hero Section -->
            <div id="hero-section" class="admin-section">
                <h2>üè† Hero Section</h2>
                <div class="form-group">
                    <label for="hero-title">T√≠tulo Principal</label>
                    <input type="text" id="hero-title" placeholder="Capturando Momentos √önicos">
                </div>
                <div class="form-group">
                    <label for="hero-subtitle">Subt√≠tulo</label>
                    <textarea id="hero-subtitle" placeholder="Fotograf√≠a profesional que transforma tus momentos especiales..."></textarea>
                </div>
                <div class="form-group">
                    <label for="hero-cta">Texto del Bot√≥n</label>
                    <input type="text" id="hero-cta" placeholder="Ver Mi Portfolio">
                </div>
                <div class="form-group">
                    <label>Imagen de Hero</label>
                    <div class="image-upload" onclick="document.getElementById('hero-image-input').click()">
                        <input type="file" id="hero-image-input" accept="image/*" style="display: none;" onchange="handleImageUpload('hero-image', this)">
                        <p>üì∑ Haz clic para subir imagen de Hero</p>
                        <img id="hero-image-preview" class="image-preview" style="display: none;">
                    </div>
                    <input type="hidden" id="hero-image">
                </div>
            </div>

            <!-- Sobre el Fot√≥grafo -->
            <div id="sobre-fotografo" class="admin-section">
                <h2>üë§ Sobre el Fot√≥grafo</h2>
                <div class="form-group">
                    <label for="photographer-name">Nombre</label>
                    <input type="text" id="photographer-name" placeholder="Carlos Mart√≠nez">
                </div>
                <div class="form-group">
                    <label for="photographer-specialty">Especialidad</label>
                    <input type="text" id="photographer-specialty" placeholder="Fotograf√≠a de Retratos y Eventos">
                </div>
                <div class="form-group">
                    <label for="photographer-experience">Experiencia</label>
                    <input type="text" id="photographer-experience" placeholder="8 a√±os de experiencia">
                </div>
                <div class="form-group">
                    <label for="photographer-bio">Biograf√≠a</label>
                    <textarea id="photographer-bio" placeholder="Con m√°s de 8 a√±os de experiencia..."></textarea>
                </div>
                <div class="form-group">
                    <label>Foto del Fot√≥grafo</label>
                    <div class="image-upload" onclick="document.getElementById('photographer-image-input').click()">
                        <input type="file" id="photographer-image-input" accept="image/*" style="display: none;" onchange="handleImageUpload('photographer-image', this)">
                        <p>üì∑ Haz clic para subir foto del fot√≥grafo</p>
                        <img id="photographer-image-preview" class="image-preview" style="display: none;">
                    </div>
                    <input type="hidden" id="photographer-image">
                </div>
            </div>

            <!-- Servicios -->
            <div id="servicios" class="admin-section">
                <h2>üéØ Servicios</h2>
                <div id="services-list" class="items-list">
                    <!-- Services will be populated by JavaScript -->
                </div>
                <button class="add-item" onclick="addService()">+ Agregar Servicio</button>
            </div>

            <!-- Portfolio -->
            <div id="portfolio" class="admin-section">
                <h2>üñºÔ∏è Portfolio</h2>
                <div id="portfolio-list" class="items-list">
                    <!-- Portfolio items will be populated by JavaScript -->
                </div>
                <button class="add-item" onclick="addPortfolioItem()">+ Agregar Imagen al Portfolio</button>
            </div>

            <!-- Blog -->
            <div id="blog" class="admin-section">
                <h2>üìù Blog</h2>
                <div id="blog-list" class="items-list">
                    <!-- Blog posts will be populated by JavaScript -->
                </div>
                <button class="add-item" onclick="addBlogPost()">+ Agregar Post del Blog</button>
            </div>

            <!-- Contacto -->
            <div id="contacto" class="admin-section">
                <h2>üìû Contacto</h2>
                <div class="form-group">
                    <label for="contact-email">Email</label>
                    <input type="email" id="contact-email" placeholder="carlos@fotografia-martinez.com">
                </div>
                <div class="form-group">
                    <label for="contact-phone">Tel√©fono</label>
                    <input type="text" id="contact-phone" placeholder="+34 678 123 456">
                </div>
                <div class="form-group">
                    <label for="contact-address">Direcci√≥n</label>
                    <input type="text" id="contact-address" placeholder="Calle Fot√≥grafos 15, Madrid 28001">
                </div>
                <div class="form-group">
                    <label for="contact-studio">Estudio</label>
                    <input type="text" id="contact-studio" placeholder="Estudio fotogr√°fico con iluminaci√≥n profesional">
                </div>
                <div class="form-group">
                    <label for="contact-availability">Horario</label>
                    <input type="text" id="contact-availability" placeholder="Lunes a S√°bado - 9:00 a 20:00">
                </div>
            </div>

            <!-- Footer -->
            <div id="footer" class="admin-section">
                <h2>üìÑ Footer</h2>
                <div class="form-group">
                    <label for="footer-title">T√≠tulo del Footer</label>
                    <input type="text" id="footer-title" placeholder="Estudio de Fotograf√≠a">
                </div>
                <div class="form-group">
                    <label for="footer-copyright">Texto de Copyright</label>
                    <input type="text" id="footer-copyright" placeholder="¬© 2025 Estudio de Fotograf√≠a Carlos Mart√≠nez. Todos los derechos reservados.">
                </div>
            </div>

            <!-- Redes Sociales -->
            <div id="redes-sociales" class="admin-section">
                <h2>üåê Redes Sociales</h2>
                <div class="social-links-grid">
                    <div class="form-group">
                        <label for="instagram-link">Instagram</label>
                        <input type="url" id="instagram-link" placeholder="https://instagram.com/carlos_fotografo">
                    </div>
                    <div class="form-group">
                        <label for="facebook-link">Facebook</label>
                        <input type="url" id="facebook-link" placeholder="https://facebook.com/carlos.fotografo">
                    </div>
                    <div class="form-group">
                        <label for="twitter-link">Twitter</label>
                        <input type="url" id="twitter-link" placeholder="https://twitter.com/carlos_fotografo">
                    </div>
                    <div class="form-group">
                        <label for="linkedin-link">LinkedIn</label>
                        <input type="url" id="linkedin-link" placeholder="https://linkedin.com/in/carlos-martinez-fotografo">
                    </div>
                    <div class="form-group">
                        <label for="website-link">Sitio Web</label>
                        <input type="url" id="website-link" placeholder="https://carlosmartinez-fotografia.com">
                    </div>
                </div>
            </div>

            <!-- Guardar -->
            <div id="guardar" class="admin-section">
                <h2>üíæ Guardar Cambios</h2>
                <p>Haz clic en el bot√≥n de abajo para guardar todos los cambios en tu sitio web.</p>
                <button id="save-button" class="admin-save" onclick="saveChanges()">
                    üíæ Guardar Todo
                </button>
                <div id="save-status" class="save-status"></div>
            </div>

            <!-- Debug Info -->
            <div id="debug-info" class="debug-info" style="display: none;">
                <!-- Debug information will be shown here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let siteData = {};
        let currentUser = null;
        let services = [];
        let portfolioItems = [];
        let blogPosts = [];

        // Debug functions
        const debugAdmin = {
            init: () => {
                console.log('‚úÖ Debug Admin Panel Inicializado');
                console.log('Funciones disponibles:');
                console.log('- debugAdmin.login() - Login manual');
                console.log('- debugAdmin.logout() - Logout');
                console.log('- debugAdmin.switchSection("section") - Cambiar secci√≥n');
                console.log('- debugAdmin.checkIdentity() - Verificar identidad');
                console.log('- debugAdmin.reloadData() - Recargar datos');
                console.log('- debugAdmin.testSave() - Probar guardado');
            },
            login: () => {
                console.log('üîê Forzando login manual...');
                if (window.netlifyIdentity) {
                    window.netlifyIdentity.on('login', (user) => {
                        console.log('üîì Usuario logueado:', user);
                    });
                    window.netlifyIdentity.open();
                }
            },
            logout: () => {
                console.log('üîí Cerrando sesi√≥n...');
                logout();
            },
            switchSection: (section) => {
                console.log('üìÑ Cambiando a secci√≥n:', section);
                showSection(section);
            },
            checkIdentity: () => {
                console.log('üîç Verificando identidad:', currentUser);
                return currentUser;
            },
            reloadData: () => {
                console.log('üîÑ Recargando datos...');
                loadSiteData();
            },
            testSave: () => {
                console.log('üß™ Probando guardado...');
                saveChanges();
            },
            reset: () => {
                console.log('üîÑ Reseteando panel...');
                location.reload();
            }
        };

        // Initialize Netlify Identity
        function initNetlifyIdentity() {
            console.log('üöÄ Inicializando Netlify Identity...');
            
            if (window.netlifyIdentity) {
                console.log('‚úÖ Netlify Identity disponible');
                
                netlifyIdentity.on('init', (user) => {
                    console.log('üîê Netlify Identity inicializado:', user ? 'Usuario autenticado' : 'Sin usuario');
                    if (user) {
                        showAdminPanel(user);
                    } else {
                        showLoginContainer();
                    }
                });

                netlifyIdentity.on('login', (user) => {
                    console.log('üîì Usuario logueado:', user);
                    netlifyIdentity.close();
                    showAdminPanel(user);
                });

                netlifyIdentity.on('logout', () => {
                    console.log('üîí Usuario deslogueado');
                    showLoginContainer();
                });

                netlifyIdentity.init();
            } else {
                console.error('‚ùå Netlify Identity no disponible');
            }
        }

        function showLoginContainer() {
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('admin-panel').style.display = 'none';
        }

        function showAdminPanel(user) {
            console.log('üéØ Mostrando panel de administraci√≥n...');
            currentUser = user;
            
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('admin-user-email').textContent = user.email;
            
            console.log('üîì Mostrando panel de administraci√≥n para:', user.email);
            
            loadSiteData();
        }

        function logout() {
            if (window.netlifyIdentity) {
                netlifyIdentity.logout();
            }
        }

        // Load site data
        async function loadSiteData() {
            console.log('üìä Cargando datos del sitio...');
            
            try {
                const response = await fetch('data.json');
                if (response.ok) {
                    siteData = await response.json();
                    console.log('‚úÖ Datos cargados exitosamente');
                    populateForm();
                } else {
                    console.error('‚ùå Error cargando datos:', response.status);
                }
            } catch (error) {
                console.error('‚ùå Error de red cargando datos:', error);
            }
        }

        // Populate form with current data
        function populateForm() {
            // Configuraci√≥n General
            document.getElementById('site-title').value = siteData.site?.title || '';
            document.getElementById('page-title').value = siteData.site?.pageTitle || '';

            // Hero Section
            document.getElementById('hero-title').value = siteData.hero?.title || '';
            document.getElementById('hero-subtitle').value = siteData.hero?.subtitle || '';
            document.getElementById('hero-cta').value = siteData.hero?.cta || '';
            document.getElementById('hero-image').value = siteData.hero?.image || '';

            // Sobre el Fot√≥grafo
            document.getElementById('photographer-name').value = siteData.photographer?.name || '';
            document.getElementById('photographer-specialty').value = siteData.photographer?.specialty || '';
            document.getElementById('photographer-experience').value = siteData.photographer?.experience || '';
            document.getElementById('photographer-bio').value = siteData.photographer?.bio || '';
            document.getElementById('photographer-image').value = siteData.photographer?.image || '';

            // Servicios
            services = siteData.services || [];
            renderServices();

            // Portfolio
            portfolioItems = siteData.portfolio || [];
            renderPortfolio();

            // Blog
            blogPosts = siteData.blog || [];
            renderBlog();

            // Contacto
            document.getElementById('contact-email').value = siteData.contact?.email || '';
            document.getElementById('contact-phone').value = siteData.contact?.phone || '';
            document.getElementById('contact-address').value = siteData.contact?.address || '';
            document.getElementById('contact-studio').value = siteData.contact?.studio || '';
            document.getElementById('contact-availability').value = siteData.contact?.availability || '';

            // Footer
            document.getElementById('footer-title').value = siteData.footer?.title || '';
            document.getElementById('footer-copyright').value = siteData.footer?.copyright || '';

            // Redes Sociales
            document.getElementById('instagram-link').value = siteData.social?.instagram || '';
            document.getElementById('facebook-link').value = siteData.social?.facebook || '';
            document.getElementById('twitter-link').value = siteData.social?.twitter || '';
            document.getElementById('linkedin-link').value = siteData.social?.linkedin || '';
            document.getElementById('website-link').value = siteData.social?.website || '';
        }

        // Show specific section
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update navigation buttons
            const navButtons = document.querySelectorAll('.admin-nav-button');
            navButtons.forEach(button => button.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Add service
        function addService() {
            services.push({
                title: 'Nuevo Servicio',
                description: 'Descripci√≥n del servicio',
                icon: 'üì∏'
            });
            renderServices();
        }

        // Render services
        function renderServices() {
            const container = document.getElementById('services-list');
            container.innerHTML = '';
            
            services.forEach((service, index) => {
                const row = document.createElement('div');
                row.className = 'item-row';
                row.innerHTML = `
                    <input type="text" value="${service.icon}" placeholder="Icono" onchange="updateService(${index}, 'icon', this.value)">
                    <input type="text" value="${service.title}" placeholder="T√≠tulo" onchange="updateService(${index}, 'title', this.value)">
                    <textarea placeholder="Descripci√≥n" onchange="updateService(${index}, 'description', this.value)">${service.description}</textarea>
                    <button onclick="removeService(${index})">Eliminar</button>
                `;
                container.appendChild(row);
            });
        }

        // Update service
        function updateService(index, field, value) {
            services[index][field] = value;
        }

        // Remove service
        function removeService(index) {
            services.splice(index, 1);
            renderServices();
        }

        // Add portfolio item
        function addPortfolioItem() {
            portfolioItems.push({
                title: 'Nueva Imagen',
                description: 'Descripci√≥n de la imagen',
                image: '',
                category: 'Retratos'
            });
            renderPortfolio();
        }

        // Render portfolio
        function renderPortfolio() {
            const container = document.getElementById('portfolio-list');
            container.innerHTML = '';
            
            portfolioItems.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'item-row';
                row.style.gridTemplateColumns = '1fr 2fr 1fr 1fr auto';
                row.innerHTML = `
                    <input type="text" value="${item.title}" placeholder="T√≠tulo" onchange="updatePortfolioItem(${index}, 'title', this.value)">
                    <textarea placeholder="Descripci√≥n" onchange="updatePortfolioItem(${index}, 'description', this.value)">${item.description}</textarea>
                    <input type="text" value="${item.category}" placeholder="Categor√≠a" onchange="updatePortfolioItem(${index}, 'category', this.value)">
                    <input type="text" value="${item.image}" placeholder="URL de imagen" onchange="updatePortfolioItem(${index}, 'image', this.value)">
                    <button onclick="removePortfolioItem(${index})">Eliminar</button>
                `;
                container.appendChild(row);
            });
        }

        // Update portfolio item
        function updatePortfolioItem(index, field, value) {
            portfolioItems[index][field] = value;
        }

        // Remove portfolio item
        function removePortfolioItem(index) {
            portfolioItems.splice(index, 1);
            renderPortfolio();
        }

        // Add blog post
        function addBlogPost() {
            blogPosts.push({
                title: 'Nueva Entrada',
                excerpt: 'Resumen del art√≠culo',
                content: 'Contenido completo del art√≠culo',
                image: '',
                date: new Date().toISOString().split('T')[0]
            });
            renderBlog();
        }

        // Render blog
        function renderBlog() {
            const container = document.getElementById('blog-list');
            container.innerHTML = '';
            
            blogPosts.forEach((post, index) => {
                const row = document.createElement('div');
                row.className = 'item-row';
                row.style.gridTemplateColumns = '1fr 2fr 1fr 1fr auto';
                row.innerHTML = `
                    <input type="text" value="${post.title}" placeholder="T√≠tulo" onchange="updateBlogPost(${index}, 'title', this.value)">
                    <textarea placeholder="Resumen" onchange="updateBlogPost(${index}, 'excerpt', this.value)">${post.excerpt}</textarea>
                    <input type="date" value="${post.date}" onchange="updateBlogPost(${index}, 'date', this.value)">
                    <input type="text" value="${post.image}" placeholder="URL de imagen" onchange="updateBlogPost(${index}, 'image', this.value)">
                    <button onclick="removeBlogPost(${index})">Eliminar</button>
                `;
                container.appendChild(row);
            });
        }

        // Update blog post
        function updateBlogPost(index, field, value) {
            blogPosts[index][field] = value;
        }

        // Remove blog post
        function removeBlogPost(index) {
            blogPosts.splice(index, 1);
            renderBlog();
        }

        // Handle image upload
        async function handleImageUpload(fieldId, input) {
            const file = input.files[0];
            if (!file) return;

            console.log('üì∑ Iniciando subida de imagen:', file.name);
            
            // Create FormData
            const formData = new FormData();
            
            // Convert file to base64
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    // Upload to Netlify Function
                    const uploadFormData = new FormData();
                    uploadFormData.append('image', e.target.result.split(',')[1]); // Remove data:image/jpeg;base64, prefix
                    
                    const response = await fetch('/.netlify/functions/upload-image', {
                        method: 'POST',
                        body: uploadFormData,
                        headers: {
                            'Authorization': `Bearer ${currentUser.token.access_token}`
                        }
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('‚úÖ Imagen subida exitosamente:', result.url);
                        document.getElementById(fieldId).value = result.url;
                        
                        // Show preview if it's a preview field
                        const previewId = fieldId + '-preview';
                        const previewImg = document.getElementById(previewId);
                        if (previewImg) {
                            previewImg.src = result.url;
                            previewImg.style.display = 'block';
                        }
                    } else {
                        console.error('‚ùå Error subiendo imagen:', response.status);
                        alert('Error subiendo imagen. Verifica que tengas permisos.');
                    }
                } catch (error) {
                    console.error('‚ùå Error de red subiendo imagen:', error);
                    alert('Error de conexi√≥n subiendo imagen.');
                }
            };
            
            reader.readAsDataURL(file);
        }

        // Collect form data
        function collectFormData() {
            return {
                site: {
                    title: document.getElementById('site-title').value,
                    pageTitle: document.getElementById('page-title').value
                },
                hero: {
                    title: document.getElementById('hero-title').value,
                    subtitle: document.getElementById('hero-subtitle').value,
                    cta: document.getElementById('hero-cta').value,
                    image: document.getElementById('hero-image').value
                },
                photographer: {
                    name: document.getElementById('photographer-name').value,
                    specialty: document.getElementById('photographer-specialty').value,
                    experience: document.getElementById('photographer-experience').value,
                    bio: document.getElementById('photographer-bio').value,
                    image: document.getElementById('photographer-image').value
                },
                services: services,
                portfolio: portfolioItems,
                blog: blogPosts,
                contact: {
                    email: document.getElementById('contact-email').value,
                    phone: document.getElementById('contact-phone').value,
                    address: document.getElementById('contact-address').value,
                    studio: document.getElementById('contact-studio').value,
                    availability: document.getElementById('contact-availability').value
                },
                footer: {
                    title: document.getElementById('footer-title').value,
                    copyright: document.getElementById('footer-copyright').value
                },
                social: {
                    instagram: document.getElementById('instagram-link').value,
                    facebook: document.getElementById('facebook-link').value,
                    twitter: document.getElementById('twitter-link').value,
                    linkedin: document.getElementById('linkedin-link').value,
                    website: document.getElementById('website-link').value
                }
            };
        }

        // Save changes
        async function saveChanges() {
            console.log('üíæ Iniciando proceso de guardado...');
            
            const saveButton = document.getElementById('save-button');
            const saveStatus = document.getElementById('save-status');
            
            // Disable button and show loading
            saveButton.disabled = true;
            saveButton.textContent = '‚è≥ Guardando...';
            saveStatus.textContent = 'Guardando cambios...';
            saveStatus.className = 'save-status';
            
            // Collect form data
            const formData = collectFormData();
            console.log('üìã Datos recopilados:', Object.keys(formData));
            
            try {
                console.log('üì∑ Subiendo im√°genes...');
                
                // Upload images if needed
                if (formData.hero.image && !formData.hero.image.startsWith('http')) {
                    // Handle hero image upload
                }
                
                if (formData.photographer.image && !formData.photographer.image.startsWith('http')) {
                    // Handle photographer image upload
                }
                
                console.log('üîë Analizando token del usuario...');
                console.log('üîç Current user object:', currentUser);
                console.log('üîç Token object:', currentUser ? currentUser.token : null);
                console.log('üîç Access token:', currentUser ? currentUser.token?.access_token : null);
                
                // Get JWT token
                let jwtToken = null;
                
                // Method 1: Try user.token.access_token
                if (currentUser && currentUser.token && currentUser.token.access_token) {
                    jwtToken = currentUser.token.access_token;
                    console.log('‚úÖ Token obtenido de user.token.access_token');
                }
                // Method 2: Try currentUser.jwt
                else if (currentUser && currentUser.jwt) {
                    jwtToken = currentUser.jwt;
                    console.log('‚úÖ Token obtenido de currentUser.jwt');
                }
                // Method 3: Try netlifyIdentity.currentUser()
                else if (window.netlifyIdentity && netlifyIdentity.currentUser()) {
                    const user = netlifyIdentity.currentUser();
                    if (user && user.token && user.token.access_token) {
                        jwtToken = user.token.access_token;
                        console.log('‚úÖ Token obtenido de netlifyIdentity.currentUser().token.access_token');
                    } else if (user && user.jwt) {
                        jwtToken = user.jwt;
                        console.log('‚úÖ Token obtenido de netlifyIdentity.currentUser().jwt');
                    }
                }
                // Method 4: Try token() method
                else if (currentUser && typeof currentUser.token === 'function') {
                    try {
                        jwtToken = await currentUser.token();
                        console.log('‚úÖ Token obtenido de currentUser.token() method');
                    } catch (error) {
                        console.log('‚ùå Error obteniendo token de method:', error);
                    }
                }
                // Method 5: Try refreshToken()
                else if (currentUser && typeof currentUser.refreshToken === 'function') {
                    try {
                        const newUser = await currentUser.refreshToken();
                        if (newUser && newUser.token && newUser.token.access_token) {
                            jwtToken = newUser.token.access_token;
                            console.log('‚úÖ Token obtenido de refreshToken().token.access_token');
                        }
                    } catch (error) {
                        console.log('‚ùå Error obteniendo token de refreshToken():', error);
                    }
                }
                
                if (!jwtToken) {
                    throw new Error('No se pudo obtener el token JWT del usuario');
                }
                
                console.log('üîë Token encontrado. Longitud:', jwtToken.length);
                console.log('üîë Token (primeros 50 caracteres):', jwtToken.substring(0, 50));
                
                console.log('üöÄ Enviando solicitud a Netlify Function...');
                
                // Send data to Netlify Function
                const response = await fetch('/.netlify/functions/update-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${jwtToken}`
                    },
                    body: JSON.stringify({ siteData: formData })
                });
                
                console.log('üì° Respuesta recibida:', response.status);
                console.log('üì° Status text:', response.statusText);
                
                // Log response headers for debugging
                console.log('üì° Response headers:');
                response.headers.forEach((value, key) => {
                    console.log(`  ${key}: ${value}`);
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Guardado exitoso:', result);
                    
                    saveStatus.textContent = '‚úÖ ¬°Cambios guardados exitosamente!';
                    saveStatus.className = 'save-status success';
                    
                    // Show debug info
                    showDebugInfo('‚úÖ Guardado exitoso: ' + JSON.stringify(result, null, 2));
                    
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå Error en respuesta:', response.status, errorText);
                    
                    saveStatus.textContent = '‚ùå Error al guardar. C√≥digo: ' + response.status;
                    saveStatus.className = 'save-status error';
                    
                    // Show detailed error
                    showDebugInfo('‚ùå Error detallado al guardar: ' + errorText, true);
                    
                    throw new Error(`Error ${response.status}: ${errorText}`);
                }
                
            } catch (error) {
                console.error('‚ùå Error detallado al guardar:', error);
                
                let errorMessage = 'Error desconocido';
                if (error.message.includes('401')) {
                    errorMessage = 'Error de autenticaci√≥n. Cierra sesi√≥n y vuelve a iniciar sesi√≥n.';
                } else if (error.message.includes('403')) {
                    errorMessage = 'Sin permisos para guardar. Verifica tu configuraci√≥n de Netlify.';
                } else if (error.message.includes('404')) {
                    errorMessage = 'Funci√≥n no encontrada. Verifica la configuraci√≥n de Netlify.';
                } else if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                    errorMessage = 'Error de red. Verifica tu conexi√≥n a internet.';
                } else {
                    errorMessage = error.message;
                }
                
                saveStatus.textContent = '‚ùå ' + errorMessage;
                saveStatus.className = 'save-status error';
                
                showDebugInfo('‚ùå Error detallado al guardar: ' + error.message, true);
            } finally {
                // Re-enable button
                saveButton.disabled = false;
                saveButton.textContent = 'üíæ Guardar Todo';
            }
        }

        // Show debug information
        function showDebugInfo(message, isError = false) {
            const debugDiv = document.getElementById('debug-info');
            debugDiv.style.display = 'block';
            debugDiv.className = isError ? 'debug-info error' : 'debug-info';
            debugDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ Inicializando Admin Panel Completo Compatible...');
            
            if (window.netlifyIdentity) {
                console.log('‚úÖ Netlify Identity disponible');
                initNetlifyIdentity();
            } else {
                console.error('‚ùå Netlify Identity no disponible');
            }
            
            console.log('‚úÖ Admin Panel Compatible con index.html cargado correctamente.');
            console.log('Funciones disponibles:');
            console.log('- debugAdmin.init()');
            console.log('- debugAdmin.login()');
            console.log('- debugAdmin.logout()');
            console.log('- debugAdmin.switchSection("section")');
            console.log('- debugAdmin.checkIdentity()');
            console.log('- debugAdmin.reloadData()');
            console.log('- debugAdmin.testSave() - Para probar guardado');
            console.log('- debugAdmin.reset()');
            console.log('');
            console.log('üìã Secciones disponibles:');
            console.log('- Configuraci√≥n General');
            console.log('- Hero Section');
            console.log('- Sobre el Fot√≥grafo');
            console.log('- Servicios');
            console.log('- Portfolio');
            console.log('- Blog');
            console.log('- Contacto');
            console.log('- Footer');
            console.log('- Redes Sociales');
            console.log('- Guardar');
            console.log('');
            console.log('üöÄ Funcionalidades incluidas:');
            console.log('- Gesti√≥n de im√°genes (Hero, Fot√≥grafo, Portfolio)');
            console.log('- Edici√≥n completa del footer y copyright');
            console.log('- Enlaces sociales completos');
            console.log('- Compatible con index.html original');
        });
    </script>
</body>
</html>